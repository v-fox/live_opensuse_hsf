[default]
profile=HSF-common

##################
# video settings #
##################

[HSF-hq]
profile-desc="Profile for proper desktops"
# it's added on top of HSF anyway, default is forced regardless of command line parameters
#profile=HSF-common
# display-resample-vdrop may cause sync issues but may be faster
video-sync=display-vdrop
opengl-pbo=yes
# nowadays 'auto' works best and will choose appropriate format for either OpenGL or Vulkan
#fbo-format=rgba16f
# blending may cause issues with user shaders but is colour-correct
blend-subtitles=no
scale=ewa_lanczossharp
# may give artifacts and is unnecessary with ewa
scale-antiring=0
cscale=ewa_lanczossharp
#dscale=mitchell
deband=yes
deband-iterations=1
deband-threshold=256
deband-range=64
# it would be nice to don't allow interlaced output BUT it's only "always on/off"
#deinterlace=yes
# maximum size gives great results but slows down seeking
scaler-lut-size=10
# do we really need blur ?
interpolation=yes
# robidouxsharp is sharp, sinc is balanced, gaussian is blurry
# https://github.com/mpv-player/mpv/issues/2685#issuecomment-434665993
tscale=box
tscale-window=sphinx
tscale-radius=0.95
# prevents ghosting with some filters but makes its own artifacts
tscale-clamp=0.0
# requires compute shaders support and in-file HDR metadata
hdr-compute-peak=yes
# use 'yuva444p16' or 'rgba' for maximum quality, 'yuv440p12' or 'rgb48' - for medium
# some shaders fail with black screen when alpha channel is present
# ravu-rgb requires non-alpha 'rgb0' but nnedi3 and vapoursynth want 'yuv440p'
# that breaks hardware decoding though and uses a whole lot of CPU !
#vf-pre=format=yuv440p12
# everything below is for most powerful cards with recent OpenGL or Vulkan
# https://github.com/igv/FSRCNN-TensorFlow
# while, supposedly, very effective in quality, may introduce video judder even without dropped frames
# 16-neuron x2 version requires about 4000 32-bit GFLOPS of AMD RX GPU power for rgba16f FBO on 1080p displays
# r1_16-0_SSIM version is recommended, r1_56-12 is supposed to be optimal but anything other than r2_8-0 may introduce stuttering
#glsl-shader="~/.config/mpv/shaders/opengl/FSRCNNX_x2_16-0-4-1_SSIM.glsl"
# https://github.com/bjin/mpv-prescalers
# several times more forgiving than FSRCNN but still may hang weak GPUs
# may be a good addition to FSRCNN for x4 enlargement of =<360p video
glsl-shader="~/.config/mpv/shaders/compute-opengl/ravu-r4-rgb.hook"
#glsl-shader="~/.config/mpv/shaders/compute-vulkan/ravu-r4-rgb.hook"
# excellent for cartoons and games
#glsl-shader=~/.config/mpv/shaders/opengl/superxbr-rgb.hook
# this likes to hang
#glsl-shader="~/.config/mpv/shaders/compute-opengl/nnedi3-nns64-win8x6.hook"
# this uses CPU and for some reason causes higher load even when it should be inactive
# enable high-quality superhigh-demand 60fps interpolation for ≤480p media
#vf-add=vapoursynth=~/.config/mpv/vapoursynth/motioninterpolation_480p.vpy
# enable high-quality superhigh-demand image doubling for ≤480p media
#vf-add=vapoursynth=~/.config/mpv/vapoursynth/nnedi3.vpy

[HSF-interpolate]
profile-desc="Preset for max-quality 4k@60 conversions in encoding mode"
profile=HSF-hq
# make sure that format is compatible with filters below
vf-pre=format=yuv444p12
autofit=4096x2160
# about 4x the size with maximum quality
glsl-shaders="~/.config/mpv/shaders/opengl/FSRCNNX_x2_r1_56-28-4-1.glsl"
# convert anything to 60fps
vf-add=vapoursynth=~/.config/mpv/vapoursynth/motioninterpolation.vpy
# encoding settings
of=mkv
#ofps=60
#omaxfps=60
#oharddup=yes
#oneverdrop=yes
oac=libopus,opus
audio-samplerate=48000
oacopts=b=192k,minrate=128k,threads=0
ovc=libvpx-vp9
ovcopts=quality=best,mbd=rd,qmin=-1,qmax=-1

[HSF-lq]
profile-desc="Profile for obsolete systems"
fbo-format=rgb16
# bilinear or bicubic_fast are safer
scale=bicubic
scale-antiring=0
#scaler-lut-size=4
cscale=bicubic
#dscale=mitchell
# disable automatic dithering for speed
#dither-depth=no
interpolation=no
tscale=oversample
#vf=format=rgb48

# https://github.com/mpv-player/mpv/issues/2214
[dplii]
profile-desc="downmix 5.1 surround to Dolby Pro Logic II compatible stereo"
# mpv's own pan filter, obsolete
#af=pan=2:[1,0,0,1,0.7071,0.7071,1,1,-0.8718,0.4899,-0.4899,0.8718]
# lavrresample method, should be drop-in replacement for the above:
#af='pan="stereo| FL = FL + 0.7071*FC + LFE + -0.7071*BL + -0.7071*BR | FR = FR + 0.7071*FC + LFE + 0.7071*BL + 0.7071*BR"' 
# same as above, and normalizing audio to avoid clipping (shouldn't be necessary for movies)
#af='pan=stereo| FL < FL + 0.7071*FC + LFE + -0.7071*BL + -0.7071*SR | FR < FR + 0.7071*FC + LFE + 0.7071*SL + 0.7071*BR'
# swresample method, use that unless you want to tweak the balance manually:
audio-swresample-o=matrix_encoding=dplii,lfe_mix_level=1
audio-channels=stereo

[HSF-common]
profile-desc="Balanced profile for modern desktop systems"
profile=opengl-hq
vo=wayland,gpu,vdpau,vaapi,xv,x11,drm,tct,caca,null,
# Needed for interpolation
video-sync=display-resample-vdrop
video-sync-max-video-change=3
# "fifo-relaxed" doesn't seem to be supported yet on RADV
#vulkan-swap-mode=mailbox
#swapchain-depth=8
vulkan-queue-count=3
# default x11egl has problems with vsync
#opengl-backend=x11
# may help with big resolutions but also may cause artifacts and slowdown
opengl-pbo=no
# anything lower than rgba12 is atrocious and rgba16f is a common default
# nowadays 'auto' works best and will choose appropriate format for either OpenGL or Vulkan
#fbo-format=rgb16f
background=000000
# use software rendering if proper GPU acceleration is missing
gpu-sw=yes
# Vulkan
# prever Vulkan over OpenGL
#gpu-api=vulkan
#spirv-compiler=shaderc
vulkan-async-transfer=yes
vulkan-async-compute=yes
# native alpha is broken in X for now
alpha=blend
# yes is faster but may lead to incorrect colours
blend-subtitles=yes
# mpv's colour correction may interfere with compositor
#target-prim=bt.709
#target-trc=srgb
# it's essential for colour conversion to happen in player, only it can know source's colour specification
# but we don't want to mess with kwin/colord's window-to-screen colour conversion
icc-profile-auto=yes
# contrast for VA-matrix displays, most other non-CRT and non-HDR ones have mere 1000
#icc-contrast=3000
dither-depth=auto
# disable randomized dithering that may cause artifacts on slow LCDs
temporal-dither=no
#scale=lanczos
scale-antiring=0.5
#cscale=spline16
#scaler-lut-size=8
scaler-resizes-only=yes
correct-downscaling=yes
linear-scaling=yes
sigmoid-upscaling=yes
# performance hog
deband=no
#interpolation=no
# https://github.com/mpv-player/mpv/issues/2685
tscale=sinc
# usually introduces horrible blur or is completely unnoticeable
#tscale-radius=3
# luma (yuv420p) is needed for vapoursynth-mvtools and non-rgb shaders
# prescaling shaders want rgba16f fbo and using them in rgb with rgb48 format filter is safer than in luma
# using rgb also forces one scale pass instead of two (l/c) and even doing so in software may be more advantesious
#vf=format=rgb0

# better precise seeking with frame interpolation
hr-seek-framedrop=no

# Start in fullscreen mode by default.
fs=no

# Always set window size to a nice auto-calculated value at startup
autofit=70%x60%

# counteract dumb mplayer-centric settings
#keepaspect=yes
#monitoraspect=0
#video-aspect=-1
#video-unscaled=no

##################
# audio settings #
##################

# Specify default audio driver (see -ao help for a list).
# JACK output for layouts larger than stereo is broken since 2015, PA-JACK conversion has to be used instead
# https://github.com/mpv-player/mpv/issues/128
#jack-std-channel-layout=waveext
jack-port=Calf Studio Gear
jack-connect=no
ao=pulse,jack,alsa,oss,null,

# better sync
initial-audio-sync=yes
autosync=0
mc=0.1

# tweaks
ad-lavc-ac3drc=1.0
# stereo / 7.1(alsa), [auto-safe] / auto
#audio-channels=stereo
audio-resample-filter-size=32
audio-resample-phase-shift=12
audio-resample-max-output-size=64
audio-swresample-o=rematrix_volume=0.75,rematrix_maxval=3.0,dither_method=improved_e_weighted,resampler=swr,phase_shift=12,filter_size=32,cutoff=1.0,precision=32,async=0,max_soft_comp=1.0,filter_type=kaiser,kaiser_beta=12,output_sample_bits=32
#audio-resample-linear=yes
audio-normalize-downmix=yes
# next 3 options may be best left for mpv to figure out
audio-format=floatp
audio-samplerate=48000
gapless-audio=yes
audio-file-auto=fuzzy

# hack to avoid buffer udner/over-runs
audio-buffer=0.192
#demuxer-lavf-buffersize=384000
pulse-buffer=92
pulse-latency-hacks=no

# Output audio to S/PDIF
#ao=alsa:device=spdif
#ac=hwac3,hwdts,hwmpa,

# default volume
volume=100
#volume-max=300
#af-add=acompressor
#replaygain=album
# RG tag may be targetting 89db while audio was produced for 96db
#replaygain-preamp=7
# "clip" to "prevent clipping" or to prevent overload by clipping ?
#replaygain-clip=no
#replaygain-fallback=0

##################
# other settings #
##################

# use the whole CPU !
vd-lavc-threads=0
ad-lavc-threads=0

# GPU decoding ?
# mpv wants to remove vdpau and non-copy flavours of hwdec may break some important features
hwdec=vaapi-copy
# it has tendency to hang AMD GPUs
#hwdec=no

vd-lavc-dr=yes

# cache a lot to avoid stutters from I/O starvation !
cache=yes
# get at least 1MB of data before attempting to use it
cache-initial=1024
cache-secs=5
cache-pause-initial=yes
demuxer-thread=yes
demuxer-readahead-secs=5
# limit buffers to sane values
demuxer-max-bytes=256MiB
demuxer-max-back-bytes=128MiB
demuxer-seekable-cache=yes
force-seekable=yes

# load more subtitles !
sub-auto=fuzzy

# get a default OSD font from fontconfig
# "DejaVu Sans" is a good choice for all
#sub-bold=yes
sub-font="Noto Sans"
sub-font-size=46
#sub-border-size=0
sub-border-color="#E6050505"
sub-color="#F0A6A650"
osd-font="Joystix"
# monospace font is needed to correctly show custom OSD but mpv-stats lua script is preferable
#osd-font="Hack"
osd-font-size=35
osd-spacing=1
osd-color="#D7AAFF7F"
#osd-border-size=0
osd-border-color="#EB000000"

# show custom important info
#osd-duration=5000
#osd-msg3="[custom statistics]\n current vo:                          ${current-vo}\n current ao:                          ${current-ao}\n frames dropped by decoder:           ${drop-frame-count}\n frames dropped by vo:                ${vo-drop-frame-count}\n frames delayed by vo:                ${vo-delayed-frame-count}\n mistimed frames:                     ${mistimed-frame-count}\n \n estimated display FPS:               ${estimated-display-fps}\n vsync ratio:                         ${vsync-ratio}\n vsync jitter:                        ${vsync-jitter}\n last  A/V sync difference:         ${avsync}\n total A/V sync correction:           ${total-avsync-change}\n audio speed correction:              ${audio-speed-correction}\n video speed correction:              ${video-speed-correction}"

# Force sub kerning
sub-ass-force-style=Kerning=yes

# Force ass margins
sub-ass-force-margins

# Make use of smart codepage guessing
sub-codepage=uchardet

# more space for subtitles at black borders
sub-margin-y=2

# positioning of multi-line subtitles
sub-justify=left
sub-ass-justify=yes

# disable joystick by default as it interferes with notebook motion sensors
#nojoystick=yes

# disable the running screen saver
#stop-screensaver
#heartbeat-cmd="xscreensaver-command -deactivate >&- 2>&- &"

# Higher quality screenshots, PNG is unfortunately too large
screenshot-format=jpg
screenshot-jpeg-quality=95
screenshot-tag-colorspace=yes
# ~/ScreenShots/SnapShots
screenshot-directory=~/ScreenShots/SnapShots

# LUA scripting
load-scripts=yes
#script=~/.config/mpv/scripts/stats.lua

# Replacement for quvi. Always use 1080p+ or 60 fps where available. Prefer VP9
# over AVC and VP8 for high-resolution streams.
ytdl=yes
ytdl-format=(bestvideo[ext=webm]/bestvideo[height>720]/bestvideo[fps=60])[tbr<13000]+(bestaudio[acodec=opus]/bestaudio[ext=webm]/bestaudio)/best
